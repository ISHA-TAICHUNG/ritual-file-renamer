# 🕯️ Ritual File Renamer 法事檔案自動配對命名工具

自動化處理法事錄影與個人照片的配對與重命名工具。

---

## ⚡ 快速開始

### 1. 下載程式

```bash
git clone https://github.com/ISHA-TAICHUNG/ritual-file-renamer.git
```

或直接下載 ZIP 檔案解壓縮。

### 2. 安裝系統依賴（首次使用）

開啟「終端機」，貼上以下指令：

```bash
# 安裝 Homebrew（如果還沒裝）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安裝所有依賴
brew install python@3.11 tesseract tesseract-lang ffmpeg
```

### 3. 啟動程式

**雙擊 `start.command` 即可！**

首次啟動會自動建立虛擬環境並安裝 Python 套件。

---

## 📖 使用教學

### GUI 介面說明

```
┌─────────────────────────────────────────────────┐
│  🕯️ 法事檔案自動配對命名工具                      │
├─────────────────────────────────────────────────┤
│  輸入資料夾: [選擇包含照片和影片的資料夾]            │
│  輸出資料夾: [選擇輸出位置]                        │
├─────────────────────────────────────────────────┤
│  配對預覽                                        │
│  ┌───────────────────────────────────────────┐  │
│  │ [001]                                      │  │
│  │   📷 IMG_0001.jpg                          │  │
│  │      時間: 2024-01-15 09:30:00 [exif]      │  │
│  │   🎬 IMG_0002.MOV                          │  │
│  │      時間: 2024-01-15 09:32:15 [video_meta]│  │
│  └───────────────────────────────────────────┘  │
├─────────────────────────────────────────────────┤
│  [═══════════════░░░░░░░░] 50%                  │
│              [👁️ 預覽] [▶️ 執行]                  │
└─────────────────────────────────────────────────┘
```

### 操作步驟

1. **選擇輸入資料夾** - 點擊「選擇」按鈕，選擇包含照片和影片的資料夾
2. **選擇輸出資料夾** - 程式會自動建議一個輸出位置，也可以自行選擇
3. **預覽配對** - 點擊「預覽」按鈕查看配對結果
4. **執行重命名** - 確認無誤後點擊「執行」

### 時間來源說明

| 標記 | 說明 |
|------|------|
| `[exif]` | 從照片 EXIF 讀取的原始拍攝時間 ✅ |
| `[video_meta]` | 從影片 metadata 讀取的原始建立時間 ✅ |
| `[filesystem]` | 從檔案系統讀取的時間（可能是下載時間）⚠️ |

> 💡 **提示**：透過 LINE 下載檔案時，選擇「原始畫質」傳送可保留原始時間資訊。

---

## 🔧 問題背景

每天處理 100+ 筆法事錄影，需要將：
- 個人照片（含英文姓名）
- 對應的法事錄影

配對並重新命名成相同檔名，方便回傳給客戶。

### 作業流程

```
1. 放照片到法壇前
2. 用 iPhone 拍那張照片（照片檔）
3. 開始錄影（影片檔）
4. 重複 1~3

↓ 一天結束 ↓

5. 傳到電腦固定資料夾
6. 執行程式
   ├── 時間排序 → 照片和影片配對
   ├── OCR 照片 → 提取英文姓名
   └── 重命名：姓名_序號.jpg / 姓名_序號.mp4
7. 輸出到雲端資料夾
```

### 照片格式要求

- 左下角有黑底白字標籤
- 第一行：英文姓名（全大寫）
- 第二行：日期（佛曆或西元）

範例：
```
CHANG CHIA HAO
2535/05/16
```

---

## 📁 輸入輸出範例

**輸入資料夾：**
```
input/
├── IMG_0001.jpg  (拍照：照片01)
├── IMG_0002.MOV  (錄影：法事01)
├── IMG_0003.jpg  (拍照：照片02)
├── IMG_0004.MOV  (錄影：法事02)
└── ...
```

**輸出資料夾：**
```
output/
├── CHANG_CHIA_HAO_001.jpg
├── CHANG_CHIA_HAO_001.mov
├── WANG_XIAO_MING_002.jpg
├── WANG_XIAO_MING_002.mov
└── ...
```

---

## ❓ 常見問題

### Q: 雙擊 start.command 沒反應？

**A:** 可能是權限問題。開啟終端機執行：
```bash
chmod +x /path/to/start.command
```

### Q: 提示「無法打開，因為它來自未識別的開發者」？

**A:** 按住 Control 鍵點擊 `start.command`，選擇「打開」。

### Q: OCR 辨識失敗？

**A:** 
1. 確認照片上的文字清晰、對比度夠高
2. 確認已安裝語言包：`brew install tesseract-lang`
3. 辨識失敗的檔案會使用序號命名（如 `UNKNOWN_001`）

### Q: LINE 下載的檔案時間不對？

**A:** 
- LINE 傳送時選擇「原始畫質」可保留 metadata
- 如果已經是壓縮過的檔案，程式會使用檔案系統時間
- 建議使用 AirDrop 或傳輸線直接傳輸

---

## 🛠️ 進階設定

### 命令列模式

如果偏好使用命令列：

```bash
cd ritual-file-renamer
source venv/bin/activate
python main.py ./input ./output

# 預覽模式（不實際執行）
python main.py ./input ./output --dry-run
```

### 手動安裝

```bash
# 建立虛擬環境
python3 -m venv venv
source venv/bin/activate

# 安裝依賴
pip install -r requirements.txt

# 啟動 GUI
python gui.py
```

---

## ⚠️ 注意事項

1. 作業時不能中途拍其他東西（會打亂順序）
2. 重錄時要刪掉失敗的影片
3. 使用同一支 iPhone 作業
4. 原始檔案不會被刪除（只複製）

---

## 📋 技術規格

- **作業系統**：macOS
- **Python**：3.10+
- **依賴**：Tesseract OCR、ffmpeg

### Python 套件
- `pytesseract` - OCR 文字辨識
- `Pillow` - 圖片處理
- `opencv-python` - 影像處理
- `exifread` - EXIF 讀取
- `customtkinter` - 現代化 GUI
- `tqdm` - 進度條

---

## 📄 授權

MIT License
